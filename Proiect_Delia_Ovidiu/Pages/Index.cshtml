@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

@foreach (var item in Model.Produse)
{
    <div class="card" style="width: 18rem;">
       <p><input type="file"  accept="image/*" name="image" id="file"  onchange="loadFile(event)" /></p>
            <p><img id="output" width="100%" /></p>
        <div class="card-body">
            <h5 class="card-title">
                @Html.DisplayFor(modelItem => item.Nume)
            </h5>
            <div class="card-text">
            <p>  @Html.DisplayFor(modelItem => item.Descriere)</p>
            <p> @Html.DisplayFor(modelItem => item.Brand.Nume)</p>
                @{
                    string categorii = string.Join(", ", item.CategorieProdus.Select(x => x.Categorie.Nume));
                }
            <p> @categorii</p>
            </div>
            <button name="addToCart" data-prod-id="@item.Id" class="btn btn-primary">Add To Cart</button>
        </div>
      
    </div>
    
}


<script>

    var elem = document.getElementsByName("addToCart");

    for (var i = 0; i<elem.length;i++) {
        console.log(elem);
        elem[i].addEventListener('click',()=> {
            addToCart(elem[i].dataset.prodId)
        });
    }

    function addToCart(prodId) {
        console.log('salut')
        fetch(`/addToCart?prodId=${prodId}`).then().catch();
    }

    var loadFile = function (event) {
        var image = document.getElementById('output');
        image.src = URL.createObjectURL(event.target.files[0]);
    };
</script>
